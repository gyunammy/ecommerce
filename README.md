
# Redis 활용 시스템 설계 회고

## 동시성 쿠폰 발급 시스템

저번주에는 Redis를 캐싱 용도로만 사용했는데, 이번에는 Queue처럼 활용해서 선착순 쿠폰 발급을 구현했다. Redis List에 LPUSH로 요청을 넣고 BRPOP으로 순차 처리하는 Producer-Consumer 패턴이다. 100명이 동시에 요청해도 50개만 정확히 발급되고 중복도 없다는 걸 테스트로 검증했지만, 직접 설계한 게 아니라 왜 이렇게 동작하는지 완전히 이해하지 못했다. Queue 추가 전후 이중 체크와 DB Unique 제약 조건 등 안전장치가 있다는 건 알겠지만 공부가 더 필요하다.

## 상품 판매량 랭킹 시스템

Redis Sorted Set으로 일일 판매량 랭킹을 구현했다. incrementScore로 판매량을 증가시키고 reverseRangeWithScores로 상위 랭킹을 조회한다. 날짜별 키 분리와 TTL 1일 설정으로 자동 만료되고, 주문 시 자동으로 랭킹이 업데이트된다. Sorted Set이 자동 정렬을 유지하면서 O(log N)으로 조회할 수 있고 incrementScore가 원자적 연산이라 동시성 문제가 없다는 건 이론적으로 이해했지만, 직접 설계한 게 아니라 확신이 없다. 앞으로 체득해야 할 기술이다.

## 마무리

Redis를 캐시 이상의 역할로 사용할 수 있다는 걸 알았지만 아직 감이 안 잡힌다. List, Sorted Set을 언제 사용하는지 이론적으로는 알지만 실전에서 직접 선택할 자신은 없다. 동시성 해결 방법(분산락, Queue 패턴, 원자적 연산)의 트레이드오프를 이해하려면 더 많은 경험이 필요하다. 왜 이렇게 설계했는지 고민하면서 공부해야겠다.
